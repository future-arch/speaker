# Speaker 项目执行规范与技术方案

## 1. 项目目标
本项目提供一套从多模态素材到宣传内容的自动化生产方案。

核心要求：
- 全流程由 LLM + 脚本驱动，可分步执行、可重复执行、可追溯。
- 用户（人）只负责技术监督、关键决策确认和必要修订。
- 输出内容需兼顾技术严谨性与传播效率，适配中文工程语境。

## 2. 输入与输出定义

### 2.1 输入素材（用户提供）
- 视频（本地文件或链接）
- 网页（URL）
- Word（`.doc/.docx`）
- Excel（`.xls/.xlsx`）
- PPT（`.ppt/.pptx`）
- PDF（含扫描版）

### 2.2 输出成果
- A：学术性或技术性文稿（结构化主文）
- B：精炼宣传稿（约 300 字）
- C：技术 Essay（约 1000 字）
- D：网页版文章（图文并茂，适合快速阅读）
- E：微信公众号宣传文（图文并茂，适合移动端阅读）

约束：
- B/C 必须包含题图与可核验证据。
- D/E 必须包含题图、摘要导语、结构化小节与配图说明。
- B、C、D、E 的观点必须可回溯到 A 或外部证据源。

## 3. 最重要：技术解决方案（推荐架构）

### 3.1 总体方案
采用“多模态解析 + 证据库（RAG）+ 工作流编排 + 质量门禁 + 多渠道渲染发布”的流水线架构。

主流程：
1. 素材接入与解析
2. 证据抽取与统一存储
3. 生成 A（技术主文）
4. 基于 A 生成 B/C
5. 基于 B/C 生成 D/E
6. 自动质检与人工确认
7. 发布与归档

### 3.2 五层架构

1. 接入层（Ingestion）
- 统一处理本地文件和 URL。
- 视频转写（ASR）、PDF OCR、Office 文档文本抽取、网页正文抽取。
- 输出统一中间格式 `source_chunks.jsonl`（含来源、时间、位置元数据）。

2. 证据层（Evidence/RAG）
- 将素材切分为可引用片段（chunk）。
- 建立向量索引 + 原文索引（便于语义检索与精确回溯）。
- 每条结论必须绑定证据 ID，支持“结论 -> 证据”追踪。

3. 生成编排层（Orchestration）
- 使用可配置工作流（step-by-step）驱动 A/B/C/D/E 产出。
- 角色拆分：
  - `Extractor`：抽事实与术语
  - `Researcher`：补充外部证据
  - `Writer`：生成目标文稿
  - `Reviewer`：检查一致性与可读性
- 所有步骤产物落盘，失败可从中间步骤重试。

4. 质量门禁层（Quality Gates）
- 事实核验：无证据结论直接拦截。
- 时效核验：凡“最新/近期/当前”类表述必须带日期和来源。
- 重复检测：语义重复段落阈值拦截。
- 风格检测：过滤空话套话与“AI腔”。
- 结构检测：字数、段落、标题、配图和引用完整性检查。

5. 发布层（Rendering/Publishing）
- D 输出为网页稿（Markdown -> HTML 模板）。
- E 输出为微信稿（Markdown -> 微信友好格式）。
- 题图来源可为：用户素材抽帧 / 合法图库 / 合规 AIGC（需标注）。

## 4. 建议目录与数据契约

建议目录：
```text
speaker/
  AGENTS.md
  data/
    raw/
    processed/
    index/
  outputs/
    A/
    B/
    C/
    D/
    E/
  scripts/
    ingest.py
    normalize.py
    build_index.py
    generate_a.py
    generate_b.py
    generate_c.py
    generate_d.py
    generate_e.py
    quality_gate.py
  prompts/
  templates/
  logs/
```

关键数据文件：
- `data/processed/source_chunks.jsonl`：标准化后的素材片段。
- `data/processed/claims.jsonl`：结论及证据映射。
- `outputs/*/meta.json`：每个产物的模型参数、时间戳、来源摘要。

## 5. 执行流程（可分步自动化）

### Step 1：素材解析
输入原始素材，输出结构化文本片段与元数据。

### Step 2：证据建库
构建向量检索与原文检索双索引。

### Step 3：生成 A
按“背景-问题-方法-证据-结论”结构生成技术主文。

### Step 4：生成 B/C
- B：传播导向（约 300 字，信息密度高）
- C：学术导向（约 1000 字，论证完整）

### Step 5：生成 D/E
- D：网页阅读体验优先（摘要、分节、配图、引用）
- E：微信阅读体验优先（短段落、强标题、可转发）

### Step 6：自动质检 + 人工确认
未通过门禁则回滚至对应步骤重生。

## 6. 输出验收标准

A：
- 结构完整，术语定义清晰，引用可追溯。

B：
- 250-350 字；一句话主张明确；有题图建议；禁止空泛口号。

C：
- 900-1200 字；论点-论据-结论闭环；至少含外部补充证据说明。

D：
- 标题、导语、3-6 个小节、结尾行动建议；可直接发布为网页。

E：
- 微信风格排版（短段落、小标题、可视化提示）；可直接粘贴到公众号编辑器。

通用要求：
- 所有“事实判断”可追溯来源。
- 不确定信息必须标注“不确定 + 补证路径”。

## 7. LLM 执行红线

1. 不得伪造引用、数据、案例或标准条文。
2. 不得将未经验证的信息写成确定性结论。
3. 不得输出明显重复或仅换词复述的段落。
4. 不得跳过证据核验直接使用“最新”类结论。
5. 不得输出明显“AI生成腔”的文本（空话套话、管理话术堆砌、与中国工程语境不符的表达）。
6. 对不确定问题必须明确说明不确定性并提出补证据路径。

## 8. 推荐技术栈（MVP）
- 语言：Python 3.13（兼容 3.12）
- 文档解析：`pymupdf`、`python-docx`、`openpyxl`、`python-pptx`、`beautifulsoup4`
- OCR/ASR：`paddleocr`（中文 OCR）、`faster-whisper`（语音转写）
- 检索：`faiss`（向量索引）+ `sqlite`/`jsonl`（原文与元数据）
- 编排：Python 脚本工作流（后续可升级到 DAG/Agent 框架）
- 质量：规则校验 + LLM 复核双层门禁
- 渲染：Markdown 模板 + HTML 模板 + 微信模板

## 9. 实施里程碑
1. M1（最小可用）：打通“素材 -> A -> B/C”链路。
2. M2：接入外部证据检索与引用追踪。
3. M3：完成 D/E 模板化发布与题图策略。
4. M4：完善质量门禁、日志审计、失败重试与批处理。

## 10. 决策原则
- 优先保证“可验证真实性”，再优化“表达效果”。
- 优先保证“流程可重复”，再追求“单次最优文案”。
- 优先选择“可维护脚本化方案”，避免早期过度复杂化。
